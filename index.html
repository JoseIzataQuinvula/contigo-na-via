<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minha Localização → Para onde você quer ir?</title>
  <meta name="theme-color" content="#1a73e8">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; background: #f0f2f5; }
    .container { max-width: 900px; margin: 20px auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 30px rgba(0,0,0,0.15); }
    header { background: #1a73e8; color: white; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 24px; }
    .content { padding: 25px; }
    .input-group { margin: 20px 0; }
    label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
    input { width: 100%; padding: 16px; font-size: 18px; border: 2px solid #ddd; border-radius: 12px; box-sizing: border-box; }
    button { 
      width: 100%; padding: 18px; font-size: 20px; background: #34a853; color: white; 
      border: none; border-radius: 12px; cursor: pointer; margin-top: 15px; font-weight: bold;
    }
    button:hover { background: #2d9147; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    #map { height: 500px; width: 100%; margin-top: 25px; border-radius: 12px; }
    .status { text-align: center; padding: 15px; font-size: 18px; border-radius: 12px; margin: 15px 0; }
    .loading { background: #e3f2fd; color: #1565c0; }
    .success { background: #e8f5e9; color: #2e7d32; }
    .error { background: #ffebee; color: #c62828; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Para onde você quer ir?</h1>
  </header>

  <div class="content">
    <div class="input-group">
      <label>Sua localização atual</label>
      <input type="text" id="origem" readonly placeholder="Buscando sua posição...">
    </div>

    <div class="status loading" id="status">Buscando sua localização atual...</div>

    <div class="input-group">
      <label>Destino</label>
      <input type="text" id="destino" placeholder="Ex: Aeroporto de Congonhas, Cristo Redentor...">
    </div>

    <button onclick="calcularRota()" id="botaoRota" disabled>Traçar Rota</button>

    <div id="info"></div>
    <div id="map"></div>
  </div>
</div>

<!-- Sua chave -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXdUY1-1VqaKPzSWMnaeAZ_LZy4Cv9QBU&callback=initMap&libraries=places" async defer></script>

<script>
  let map, directionsService, directionsRenderer;
  let minhaLocalizacao = null;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: -14.2350, lng: -51.9253 },
      zoom: 15
    });

    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({
      suppressMarkers: false,
      polylineOptions: { strokeColor: "#1a73e8", strokeWeight: 8 }
    });
    directionsRenderer.setMap(map);

    // Autocomplete no campo destino
    new google.maps.places.Autocomplete(document.getElementById('destino'));

    // COMEÇA AUTOMATICAMENTE A BUSCAR A LOCALIZAÇÃO
    pegarLocalizacaoAutomatico();
  }

  function pegarLocalizacaoAutomatico() {
    const status = document.getElementById('status');

    if (!navigator.geolocation) {
      status.className = "status error";
      status.textContent = "Seu navegador não suporta localização";
      document.getElementById('origem').value = "Localização não suportada";
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        minhaLocalizacao = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        // Converte para endereço bonito
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ location: minhaLocalizacao }, (results, status) => {
          if (status === "OK" && results[0]) {
            document.getElementById('origem').value = results[0].formatted_address;
          } else {
            document.getElementById('origem').value = `Minha localização atual`;
          }

          // Atualiza UI
          document.getElementById('status').className = "status success";
          document.getElementById('status').textContent = "Localização encontrada!";
          document.getElementById('botaoRota').disabled = false;

          // Centraliza mapa no usuário
          map.setCenter(minhaLocalizacao);
          new google.maps.Marker({
            position: minhaLocalizacao,
            map: map,
            title: "Você está aqui",
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 10,
              fillColor: "#1a73e8",
              fillOpacity: 1,
              strokeWeight: 4,
              strokeColor: "#fff"
            }
          });
        });
      },
      (erro) => {
        document.getElementById('botaoRota').disabled = false;
        document.getElementById('origem').readOnly = false;
        document.getElementById('origem').placeholder = "Digite a origem manualmente";

        if (erro.code === 1) {
          status.className = "status error";
          status.innerHTML = "Você bloqueou a localização. <br>Digite a origem manualmente ou permita no navegador.";
        } else {
          status.className = "status error";
          status.textContent = "Não foi possível encontrar sua localização";
        }
      },
      { timeout: 15000, maximumAge: 60000, enableHighAccuracy: true }
    );
  }

  function calcularRota() {
    const destino = document.getElementById('destino').value.trim();
    if (!destino) {
      alert("Digite para onde você quer ir!");
      return;
    }

    if (!minhaLocalizacao && !document.getElementById('origem').value) {
      alert("Aguarde a localização ou digite a origem");
      return;
    }

    const request = {
      origin: minhaLocalizacao || document.getElementById('origem').value,
      destination: destino,
      travelMode: google.maps.TravelMode.DRIVING
    };

    directionsService.route(request, (result, status) => {
      if (status === 'OK') {
        directionsRenderer.setDirections(result);
        const leg = result.routes[0].legs[0];
        document.getElementById('info').innerHTML = `
          <div style="background:#e8f5e9;padding:15px;border-radius:12px;margin:15px 0;text-align:center;font-size:18px;">
            <strong>Rota pronta!</strong><br>
            Distância: <strong>${leg.distance.text}</strong> • 
            Tempo: <strong>${leg.duration.text}</strong>
          </div>
        `;
      } else {
        document.getElementById('info').innerHTML = `<div style="color:red;padding:15px;">Não foi possível traçar a rota. Verifique o destino.</div>`;
      }
    });
  }
</script>

</body>
</html>
