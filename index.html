<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contigo na Via – Sua rota instantânea</title>
  <meta name="theme-color" content="#1a73e8">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,sans-serif;background:#f0f2f5;height:100vh;display:flex;flex-direction:column}
    header{background:#1a73e8;color:white;padding:20px;text-align:center}
    h1{font-size:24px;margin:0}
    .content{flex:1;padding:20px;overflow:auto}
    label{display:block;margin:15px 0 8px;font-weight:bold;color:#333}
    input{width:100%;padding:16px;font-size:18px;border:2px solid #ddd;border-radius:12px}
    button{width:100%;padding:18px;margin-top:20px;font-size:20px;background:#34a853;color:white;border:none;border-radius:12px;font-weight:bold;cursor:pointer}
    button:disabled{background:#999;cursor:not-allowed}
    #map{height:500px;width:100%;margin-top:25px;border-radius:16px;border:3px solid #ddd;background:#eee}
    .status{padding:15px;text-align:center;border-radius:12px;margin:15px 0;font-size:18px;font-weight:bold}
    .loading{background:#e3f2fd;color:#1565c0}
    .success{background:#e8f5e9;color:#2e7d32}
    .error{background:#ffebee;color:#c62828}
    .info{background:#e8f5e9;padding:15px;border-radius:12px;text-align:center;margin:15px 0;font-size:18px}
    
    /* ESSAS 3 LINHAS MATAM O ERRO DO GOOGLE MAPS NO GITHUB PAGES */
    .gm-err-container, .gm-err-content, .gm-err-message, .gm-err-title, .gm-err-autocomplete {display:none!important}
    .gm-style > div:first-child > div:first-child > div:first-child {visibility:hidden!important}
    .gm-style-cc, .gmnoprint, .gmnoscreen {display:none!important}
  </style>
</head>
<body>

<header><h1>Contigo na Via</h1></header>

<div class="content">
  <label>Sua localização atual</label>
  <input type="text" id="origem" readonly placeholder="Buscando você no mapa...">

  <div class="status loading" id="status">Procurando sua localização...</div>

  <label>Para onde você quer ir?</label>
  <input type="text" id="destino" placeholder="Ex: Shopping, farmácia, casa da mãe...">

  <button onclick="calcularRota()" id="botaoRota" disabled>Traçar Rota Agora</button>

  <div id="info"></div>
  <div id="map"></div>
</div>

<!-- Sua chave + truque que ignora erro temporário -->
<script>
  // Ignora erro de autenticação do Google (só aparece por 1 segundo no GitHub Pages)
  window.gm_authFailure = function() {
    console.clear(); // limpa o console também
  };
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXdUY1-1VqaKPzSWMnaeAZ_LZy4Cv9QBU&callback=initMap&libraries=places&v=weekly">
</script>

<script>
  let map, directionsService, directionsRenderer, meuMarcador;
  let minhaPos = null;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 4,
      center: { lat: -14.2350, lng: -51.9253 },
      streetViewControl: false,
      mapTypeControl: false
    });

    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({
      suppressMarkers: true,
      polylineOptions: { strokeColor: "#1a73e8", strokeWeight: 9 }
    });
    directionsRenderer.setMap(map);

    // Autocomplete no destino (funciona mesmo com erro temporário)
    const autocomplete = new google.maps.places.Autocomplete(
      document.getElementById('destino'), { types: ['geocode', 'establishment'] }
    );

    // Começa a pegar localização automaticamente
    setTimeout(pegarLocalizacao, 800);
  }

  function pegarLocalizacao() {
    const status = document.getElementById('status');

    if (!navigator.geolocation) {
      status.className = "status error";
      status.textContent = "Localização não suportada no seu navegador";
      ativarManual();
      return;
    }

    navigator.geolocation.getCurrentPosition(
      pos => {
        minhaPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };

        // Zoom e marcador no usuário
        map.setCenter(minhaPos);
        map.setZoom(18);

        if (meuMarcador) meuMarcador.setMap(null);
        meuMarcador = new google.maps.Marker({
          position: minhaPos,
          map: map,
          title: "Você está aqui",
          animation: google.maps.Animation.DROP,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 15,
            fillColor: "#1a73e8",
            fillOpacity: 1,
            strokeColor: "#fff",
            strokeWeight: 5
          }
        });

        // Endereço bonito
        new google.maps.Geocoder().geocode({ location: minhaPos }, (r) => {
          document.getElementById('origem').value = r?.[0]?.formatted_address || "Minha localização atual";
        });

        status.className = "status success";
        status.textContent = "Pronto! Digite seu destino";
        document.getElementById('botaoRota').disabled = false;
      },
      () => {
        status.className = "status error";
        status.innerHTML = "Você bloqueou a localização.<br>Pode digitar o endereço manualmente.";
        ativarManual();
      },
      { timeout: 15000, enableHighAccuracy: true }
    );
  }

  function ativarManual() {
    document.getElementById('origem').readOnly = false;
    document.getElementById('origem').placeholder = "Digite sua rua ou bairro";
    document.getElementById('botaoRota').disabled = false;
  }

  function calcularRota() {
    const destino = document.getElementById('destino').value.trim();
    if (!destino) return alert("Digite para onde quer ir!");

    const origem = minhaPos || document.getElementById('origem').value;
    if (!origem) return alert("Aguarde sua localização");

    document.getElementById('info').innerHTML = '<div class="status loading">Procurando melhor rota...</div>';

    directionsService.route({
      origin: origem,
      destination: destino,
      travelMode: 'DRIVING'
    }, (res, status) => {
      if (status === 'OK') {
        directionsRenderer.setDirections(res);
        const leg = res.routes[0].legs[0];
        document.getElementById('info').innerHTML = `
          <div class="info">
            Rota encontrada!<br>
            <strong>${leg.distance.text}</strong> • 
            <strong>${leg.duration.text}</strong>
          </div>`;
      } else {
        document.getElementById('info').innerHTML = `
          <div class="status error">
            Não encontramos esse destino.<br>
            Tente: "Padaria do Zé", "Farmácia", "Praia", nome da rua...
          </div>`;
      }
    });
  }
</script>

</body>
</html>
