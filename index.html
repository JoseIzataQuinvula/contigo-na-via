<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MotoJá Clean – O mais limpo e preciso de Angola</title>

  <!-- Leaflet + Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/@leaflet/leaflet-routing-machine@latest/dist/leaflet.routing.machine.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background:#f8f9fa; }

    header {
      background: #ff6b00;
      color: white;
      text-align: center;
      padding: 90px 20px 70px;
    }
    header h1 { font-size: 3rem; font-weight: 800; }
    header p { font-size: 1.4rem; margin-top: 8px; }

    .container { max-width: 960px; margin: -50px auto 50px; position: relative; z-index: 10; }
    .card { background: white; border-radius: 24px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.12); }

    #map { height: 420px; }

    .form { padding: 35px; }

    .search-container {
      position: relative;
      margin: 20px 0;
    }
    input[type=text], input[type=tel] {
      width: 100%;
      padding: 18px 20px 18px 50px;
      border: 2px solid #eee;
      border-radius: 16px;
      font-size: 1.1rem;
      transition: 0.3s;
    }
    input:focus { border-color: #ff6b00; outline: none; }

    .icon { position:absolute; left:18px; top:19px; color:#888; font-size:1.3rem; }

    /* Lista de resultados da busca */
    .results {
      position: absolute;
      top: 100%;
      left: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      max-height: 300px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    .result-item {
      padding: 14px 20px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
    }
    .result-item:hover { background: #fff4e6; }
    .result-item:last-child { border:none; }

    .moto-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 30px 0;
    }
    .moto {
      padding: 20px;
      text-align: center;
      border: 2px solid #eee;
      border-radius: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    .moto.selected {
      border-color: #ff6b00;
      background: #fff8f0;
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(255,107,0,0.2);
    }
    .moto h4 { margin: 10px 0 8px; }
    .moto .preco { font-size: 1.4rem; font-weight: 800; color:#ff6b00; }

    .price-total {
      text-align: center;
      font-size: 2rem;
      font-weight: 800;
      color: #ff6b00;
      margin: 30px 0;
      padding: 20px;
      background: #fff8f0;
      border-radius: 16px;
    }

    .btn {
      background: #ff6b00;
      color: white;
      border: none;
      padding: 20px;
      font-size: 1.5rem;
      font-weight: 700;
      border-radius: 16px;
      width: 100%;
      cursor: pointer;
    }
    .btn:disabled { background:#ccc; cursor:not-allowed; }

    .status { display:none; padding:40px; text-align:center; background:#f0fff4; }
  </style>
</head>
<body>

<header>
  <h1>MotoJá Clean</h1>
  <p>Linha perfeita • Pesquisa inteligente • Preço na hora</p>
</header>

<div class="container">
  <div class="card">
    <div id="map"></div>

    <div class="form">
      <!-- Origem -->
      <div class="search-container">
        <i class="fas fa-map-marker-alt icon"></i>
        <input type="text" id="originInput" placeholder="Origem – GPS automático ou digite">
        <div class="results" id="originResults"></div>
      </div>

      <!-- Destino -->
      <div class="search-container">
        <i class="fas fa-flag-checkered icon"></i>
        <input type="text" id="destInput" placeholder="Destino – digite (ex: Camama, Talatona, Viana…)">
        <div class="results" id="destResults"></div>
      </div>

      <!-- Tipo de moto (sem imagem – só texto) -->
      <h3 style="margin:30px 0 15px;">Tipo de moto</h3>
      <div class="moto-grid" id="motoGrid"></div>

      <div class="price-total" id="priceBox">Selecione o destino para ver o preço</div>

      <input type="text" id="nome" placeholder="Seu nome" style="margin-top:20px;" required>
      <input type="tel" id="telefone" placeholder="WhatsApp com DDD" required>

      <button class="btn" id="chamarBtn" disabled>CHAMAR MOTOTÁXI</button>
    </div>

    <div class="status" id="status">
      <h2>Procurando o melhor mototaxista…</h2>
      <p style="font-size:1.5rem;margin:20px 0;">
        <span id="views">0</span> viram • <span id="accepts">0</span> aceitaram
      </p>
      <div id="aceitou"></div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@leaflet/leaflet-routing-machine@latest/dist/leaflet.routing.machine.min.js"></script>

<script>
// Dados das motos (sem imagem)
const motos = [
  { nome: "Padrão 160cc",      precoKm: 850 },
  { nome: "Scooter PCX",       precoKm: 1300 },
  { nome: "Big Trail XRE/Bros",precoKm: 1100 },
  { nome: "Sport Twister",     precoKm: 1200 },
  { nome: "Com Baú",           precoKm: 950 },
  { nome: "Luxo / Elétrica",   precoKm: 1600 }
];

let map = L.map('map').setView([-8.8383, 13.2344], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let routingControl = null;
let origem = null, destino = null;
let motoSelecionada = motos[0];

// Marcadores bonitos
const iconOrigem = L.divIcon({className:"", html:'<div style="background:#ff6b00;color:white;padding:8px 14px;border-radius:30px;font-weight:bold;">Partida</div>', iconSize:[100,40]});
const iconDestino = L.divIcon({className:"", html:'<div style="background:#28a745;color:white;padding:8px 14px;border-radius:30px;font-weight:bold;">Chegada</div>', iconSize:[100,40]});

let markerO = null, markerD = null;

// GPS automático na origem
navigator.geolocation.getCurrentPosition(pos => {
  origem = [pos.coords.latitude, pos.coords.longitude];
  map.setView(origem, 16);
  markerO = L.marker(origem, {icon: iconOrigem}).addTo(map);
  reverseGeocode(origem, 'originInput');
  verificarBotao();
});

// Função de busca inteligente
function buscar(enderecoInput, resultsDiv, callback) {
  const query = enderecoInput.value.trim();
  if (query.length < 3) {
    resultsDiv.style.display = 'none';
    return;
  }

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ', Luanda, Angola')}&limit=8&countrycodes=ao`)
    .then(r => r.json())
    .then(data => {
      resultsDiv.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'result-item';
        div.textContent = item.display_name.split(', ').slice(0,3).join(', ');
        div.onclick = () => {
          const latlng = [parseFloat(item.lat), parseFloat(item.lon)];
          if (enderecoInput.id === 'originInput') {
            origem = latlng;
            if (markerO) map.removeLayer(markerO);
            markerO = L.marker(origem, {icon: iconOrigem}).addTo(map);
          } else {
            destino = latlng;
            if (markerD) map.removeLayer(markerD);
            markerD = L.marker(destino, {icon: iconDestino}).addTo(map);
          }
          map.setView(latlng, 16);
          enderecoInput.value = item.display_name.split(', ').slice(0,3).join(', ');
          resultsDiv.style.display = 'none';
          calcularRota();
        };
        resultsDiv.appendChild(div);
      });
      resultsDiv.style.display = data.length ? 'block' : 'none';
    });
}

// Eventos de busca
document.getElementById('originInput').addEventListener('input', () => buscar(document.getElementById('originInput'), document.getElementById('originResults')));
document.getElementById('destInput').addEventListener('input', () => buscar(document.getElementById('destInput'), document.getElementById('destResults')));

// Clique no mapa também funciona
map.on('click', e => {
  if (!origem) {
    origem = [e.latlng.lat, e.latlng.lng];
    if (markerO) map.removeLayer(markerO);
    markerO = L.marker(origem, {icon: iconOrigem}).addTo(map);
    reverseGeocode(origem, 'originInput');
  } else if (!destino) {
    destino = [e.latlng.lat, e.latlng.lng];
    if (markerD) map.removeLayer(markerD);
    markerD = L.marker(destino, {icon: iconDestino}).addTo(map);
    reverseGeocode(destino, 'destInput');
    calcularRota();
  }
});

function reverseGeocode(latlng, inputId) {
  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latlng[0]}&lon=${latlng[1]}`)
    .then(r=>r.json())
    .then(d => {
      const addr = d.display_name.split(', ').slice(0,4).join(', ');
      document.getElementById(inputId).value = addr;
    });
}

function calcularRota() {
  if (!origem || !destino) return;

  if (routingControl) map.removeControl(routingControl);
  routingControl = L.Routing.control({
    waypoints: [L.latLng(origem), L.latLng(destino)],
    createMarker: () => null,
    lineOptions: { styles: [{color: '#ff6b00', weight: 8, opacity: 0.9}] },
    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),
    addWaypoints: false,
    draggableWaypoints: false
  }).addTo(map);

  routingControl.on('routesfound', e => {
    const km = (e.routes[0].summary.totalDistance / 1000).toFixed(1);
    const preco = Math.round(km * motoSelecionada.precoKm * 1.35);
    document.getElementById('priceBox').innerHTML = `${preco.toLocaleString()} Kz <small style="font-size:1rem;">(${km} km)</small>`;
    verificarBotao();
  });
}

function verificarBotao() {
  const btn = document.getElementById('chamarBtn');
  btn.disabled = !(origem && destino && document.getElementById('nome').value && document.getElementById('telefone').value);
}

// Preenche motos (só texto)
motos.forEach((m, i) => {
  const div = document.createElement('div');
  div.className = 'moto' + (i===0 ? ' selected' : '');
  div.innerHTML = `<h4>${m.nome}</h4><div class="preco">${m.precoKm} Kz/km</div>`;
  div.onclick = () => {
    document.querySelectorAll('.moto').forEach(x=>x.classList.remove('selected'));
    div.classList.add('selected');
    motoSelecionada = m;
    calcularRota();
  };
  document.getElementById('motoGrid').appendChild(div);
});

// Botão chamar
document.getElementById('chamarBtn').onclick = () => {
  document.querySelector('.form').style.display = 'none';
  document.getElementById('status').style.display = 'block';

  let v = 0, a = 0;
  const int = setInterval(() => {
    v += Math.floor(Math.random()*3)+1;
    document.getElementById('views').textContent = v;
    if (Math.random() > 0.55 && a < 1) {
      a = 1;
      document.getElementById('accepts').textContent = a;
      document.getElementById('aceitou').innerHTML = `<h2>José Flash aceitou!<br>Placa LD-99-88-AA • Chega em 4 minutos</h2>`;
      clearInterval(int);
    }
  }, 1800);
};
</script>
</body>
</html>
