<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MotoJá PRO – O mais avançado de Angola e Brasil</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #ff6b00;
      --dark: #111;
      --light: #f8f9fa;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Poppins',sans-serif; background:var(--light); }

    header {
      background: linear-gradient(135deg, #ff6b00, #ff8c33);
      color:white; text-align:center; padding:80px 20px 60px;
    }
    header h1 { font-size:3rem; }
    header p { font-size:1.4rem; margin-top:10px; }

    .container { max-width:1100px; margin:0 auto; padding:20px; }

    .card {
      background:white;
      border-radius:20px;
      box-shadow:0 20px 50px rgba(0,0,0,0.12);
      overflow:hidden;
      margin-top:-60px;
    }

    #map { height:350px; }

    .form-section { padding:30px; }

    input, select {
      width:100%; padding:16px; margin:10px 0; border-radius:12px; border:1px solid #ddd; font-size:1rem;
    }

    .moto-grid {
      display:grid; grid-template-columns:repeat(auto-fit, minmax(140px,1fr)); gap:15px; margin:20px 0;
    }
    .moto-card {
      border:3px solid #eee; border-radius:15px; text-align:center; padding:15px; cursor:pointer; transition:0.3s;
    }
    .moto-card img { width:100%; height:110px; object-fit:cover; border-radius:10px; }
    .moto-card.selected { border-color:var(--primary); background:#fff4e6; transform:scale(1.05); }
    .price { font-weight:700; color:var(--primary); font-size:1.3rem; }

    .btn {
      background:var(--primary); color:white; border:none; padding:18px; border-radius:12px;
      font-size:1.3rem; width:100%; margin-top:20px; cursor:pointer;
    }
    .btn:hover { background:#e55a00; }

    .status-box {
      margin-top:30px; padding:25px; background:#f0f8ff; border-radius:15px; text-align:center; display:none;
    }
    .drivers-list {
      display:grid; gap:15px; margin-top:20px;
    }
    .driver {
      background:white; padding:15px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.08);
      display:flex; align-items:center; gap:15px;
    }
    .driver img { width:60px; height:60px; border-radius:50%; }
    .accepted { border-left:6px solid #28a745; background:#f8fff8; }

    @media(max-width:768px){
      header h1{font-size:2.3rem;}
      .card{margin: -40px 15px 0;}
    }
  </style>
</head>
<body>

<header>
  <h1>MotoJá PRO</h1>
  <p>Escolha a moto • Veja o preço antes • Acompanhe quem aceitou</p>
</header>

<div class="container">
  <div class="card">
    <div id="map"></div>

    <div class="form-section">
      <h2 style="text-align:center; color:var(--primary);">Para onde você vai?</h2>

      <input type="text" id="origin" placeholder="Origem (detectada automaticamente)" readonly>
      <input type="text" id="destination" placeholder="Digite o destino" required>

      <h3 style="margin:center; margin:25px 0 15px;">Escolha o tipo de moto</h3>
      <div class="moto-grid" id="motoGrid"></div>

      <div style="text-align:center; margin:25px 0; font-size:1.5rem; font-weight:700; color:var(--primary);">
        Valor estimado: <span id="price">Aguardando destino...</span>
      </div>

      <input type="text" id="name" placeholder="Seu nome" required>
      <input type="tel" id="phone" placeholder="WhatsApp com DDD" required>

      <button class="btn" id="requestBtn">CHAMAR MOTOTÁXI AGORA</button>
    </div>

    <!-- Tela de acompanhamento em tempo real -->
    <div class="status-box" id="statusBox">
      <h2>Aguarde... enviando para os mototaxistas</h2>
      <p><strong><span id="views">0</span></strong> mototaxistas visualizaram • <strong><span id="accepts">0</span></strong> aceitaram</p>

      <div class="drivers-list" id="driversList"></div>

      <button class="btn" onclick="location.reload()" style="margin-top:20px; background:#666;">Cancelar e pedir outra</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@leaflet/leaflet-routing-machine@latest/dist/leaflet.routing.machine.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@leaflet/leaflet-routing-machine@latest/dist/leaflet.routing.machine.css" />

<script>
// Lista de motos com foto e preço por km
const motos = [
  {nome:"Padrão 160cc", img:"https://i.imgur.com/5t2o5vP.jpeg", precoKm: 800},
  {nome:"Scooter PCX", img:"https://i.imgur.com/2y3vQ3d.jpeg", precoKm: 1200},
  {nome:"Big Trail Bros", img:"https://i.imgur.com/X7kL9pM.jpeg", precoKm: 1000},
  {nome:"Sport Twister", img:"https://i.imgur.com/K9pM2vL.jpeg", precoKm: 1100},
  {nome:"Com Baú", img:"https://i.imgur.com/8nL2pQ1.jpeg", precoKm: 900},
  {nome:"Elétrica Luxo", img:"https://i.imgur.com/3vP9mX2.jpeg", precoKm: 1500},
];

// Preenche grid de motos
const grid = document.getElementById('motoGrid');
let selectedMoto = motos[0];
motos.forEach((moto, i) => {
  const div = document.createElement('div');
  div.className = 'moto-card' + (i===0?' selected':'');
  div.innerHTML = `
    <img src="${moto.img}" alt="${moto.nome}">
    <p><strong>${moto.nome}</strong></p>
    <p class="price">${moto.precoKm.toLocaleString()} Kz/km</p>
  `;
  div.onclick = () => {
    document.querySelectorAll('.moto-card').forEach(c=>c.classList.remove('selected'));
    div.classList.add('selected');
    selectedMoto = moto;
    calculatePrice();
  };
  grid.appendChild(div);
});

// Mapa + rota
const map = L.map('map').setView([-8.8383, 13.2344], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let routingControl = null;
let userLocation = null;
let markerOrigem = null;

// Pega localização do usuário
navigator.geolocation.getCurrentPosition(pos => {
  userLocation = [pos.coords.latitude, pos.coords.longitude];
  map.setView(userLocation, 16);
  markerOrigem = L.marker(userLocation).addTo(map).bindPopup("Você está aqui").openPopup();

  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation[0]}&lon=${userLocation[1]}`)
    .then(r=>r.json())
    .then(data => {
      document.getElementById('origin').value = data.display_name.split(', ').slice(0,4).join(', ');
    });
});

// Quando digita destino → traça rota e calcula preço
document.getElementById('destination').addEventListener('change', calculateRoute);

function calculateRoute() {
  const dest = document.getElementById('destination').value;
  if (!dest || !userLocation) return;

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dest)}`)
    .then(r=>r.json())
    .then(data => {
      if (data.length === 0) return;
      const latlng = [parseFloat(data[0].lat), parseFloat(data[0].lon)];

      if (routingControl) map.removeControl(routingControl);
      routingControl = L.Routing.control({
        waypoints: [L.latLng(userLocation), L.latLng(latlng)],
        routeWhileDragging: true,
        createMarker: () => null,
        lineOptions: { styles: [{color: '#ff6b00', weight: 7}] },
        router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' })
      }).addTo(map);

      // Calcula distância
      const route = routingControl.getPlan().getDistance() / 1000; // km
      const price = Math.round(route * selectedMoto.precoKm * 1.3); // +30% taxa mínima
      document.getElementById('price').textContent = price.toLocaleString() + " Kz";
    });
}

function calculatePrice() {
  if (routingControl) calculateRoute();
}

// Simulação em tempo real (substitua por Firebase/Node.js depois)
const fakeDrivers = [
  {nome:"João Moto", foto:"https://randomuser.me/api/portraits/men/32.jpg", placa:"LD-12-34-AB", tempo:"4 min"},
  {nome:"Carlos Flash", foto:"https://randomuser.me/api/portraits/men/45.jpg", placa:"LD-56-78-CD", tempo:"5 min"},
  {nome:"Maria Thunder", foto:"https://randomuser.me/api/portraits/women/68.jpg", placa:"LD-90-12-EF", tempo:"6 min"},
  {nome:"Pedro Raio", foto:"https://randomuser.me/api/portraits/men/23.jpg", placa:"LD-34-56-GH", tempo:"7 min"},
];

document.getElementById('requestBtn').onclick = () => {
  const nome = document.getElementById('name').value;
  const tel = document.getElementById('phone').value;
  if (!nome || !tel || !document.getElementById('destination').value === '') {
    alert("Preencha todos os campos!");
    return;
  }

  document.querySelector('.form-section').style.display = 'none';
  document.getElementById('statusBox').style.display = 'block';

  let views = 0, accepts = 0;
  const viewsEl = document.getElementById('views');
  const acceptsEl = document.getElementById('accepts');
  const list = document.getElementById('driversList');

  const interval = setInterval(() => {
    views += Math.floor(Math.random()*3) + 1;
    viewsEl.textContent = views;

    if (Math.random() > 0.6 && accepts < 3) {
      accepts++;
      acceptsEl.textContent = accepts;

      const driver = fakeDrivers[accepts-1];
      const div = document.createElement('div');
      div.className = 'driver accepted';
      div.innerHTML = `
        <img src="${driver.foto}">
        <div>
          <strong>${driver.nome}</strong> aceitou sua corrida!<br>
          Placa: ${driver.placa} • Chega em ${driver.tempo}
        </div>
        <i class="fas fa-check-circle" style="color:#28a745; font-size:2rem;"></i>
      `;
      list.prepend(div);

      if (accepts === 1) {
        clearInterval(interval);
        setTimeout(() => {
          alert(`Parabéns! ${driver.nome} está indo te buscar em ${driver.tempo}!`);
        }, 1500);
      }
    }
  }, 1800);
};
</script>
</body>
</html>
